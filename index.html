<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue 3 稳健时钟</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/dayjs@1/dayjs.min.js"></script>
    
    <style>
        :root {
            --bg-color: #2c3e50;
            --clock-face: #ecf0f1;
            --hour-hand: #2c3e50;
            --minute-hand: #7f8c8d;
            --second-hand: #e74c3c;
            --marker-color: #bdc3c7;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color);
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        #app {
            text-align: center;
        }

        /* 表盘外壳 */
        .clock {
            width: 300px;
            height: 300px;
            background-color: var(--clock-face);
            border-radius: 50%;
            border: 10px solid #fff;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        /* 中心点 */
        .clock::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--second-hand);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        /* 指针通用样式 */
        .hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center; /* 关键：设置旋转中心在底部 */
            border-radius: 4px 4px 0 0;
            transition: transform 0.05s cubic-bezier(0.4, 2.3, 0.3, 1); /* 增加一点弹性动画 */
        }

        /* 时针 */
        .hour {
            width: 8px;
            height: 70px;
            background: var(--hour-hand);
            margin-left: -4px; /* 居中校正 */
            z-index: 2;
        }

        /* 分针 */
        .minute {
            width: 6px;
            height: 100px;
            background: var(--minute-hand);
            margin-left: -3px;
            z-index: 3;
        }

        /* 秒针 */
        .second {
            width: 2px;
            height: 120px;
            background: var(--second-hand);
            margin-left: -1px;
            z-index: 4;
        }

        /* 刻度 (通过 JS 生成，减少 HTML 冗余) */
        .marker {
            position: absolute;
            width: 2px;
            height: 10px;
            background: var(--marker-color);
            left: 50%;
            top: 10px;
            transform-origin: 50% 140px; /* 140px = 半径(150) - top(10) */
            margin-left: -1px;
        }
        
        /* 突出 3, 6, 9, 12 点 */
        .marker.big {
            width: 4px;
            height: 15px;
            background: #95a5a6;
            margin-left: -2px;
        }

        /* 数字时间显示 */
        .digital-time {
            color: #fff;
            font-size: 2rem;
            font-weight: 300;
            letter-spacing: 2px;
            font-variant-numeric: tabular-nums; /* 防止数字跳动 */
        }
        
        .date-display {
            color: #bdc3c7;
            margin-top: 5px;
            font-size: 1rem;
        }
    </style>
</head>
<body>

<div id="app">
    <div class="clock">
        <div 
            v-for="n in 12" 
            :key="n" 
            class="marker" 
            :class="{ big: n % 3 === 0 }"
            :style="{ transform: `rotate(${n * 30}deg)` }"
        ></div>

        <div class="hand hour" :style="{ transform: `rotate(${hourDegree}deg)` }"></div>
        <div class="hand minute" :style="{ transform: `rotate(${minuteDegree}deg)` }"></div>
        <div class="hand second" :style="{ transform: `rotate(${secondDegree}deg)` }"></div>
    </div>

    <div class="digital-time">{{ formattedTime }}</div>
    <div class="date-display">{{ formattedDate }}</div>
</div>

<script>
    const { createApp, ref, computed, onMounted, onUnmounted } = Vue;

    createApp({
        setup() {
            // 使用 ref 存储当前时间对象
            const currentTime = ref(dayjs());
            let timer = null;

            // 核心逻辑：更新时间
            const updateTime = () => {
                currentTime.value = dayjs();
            };

            // 生命周期：挂载时启动定时器
            onMounted(() => {
                // 每秒刷新一次 (如果需要秒针更平滑，可以使用 requestAnimationFrame)
                timer = setInterval(updateTime, 1000);
            });

            // 生命周期：卸载时清除定时器 (防止内存泄漏 Bug)
            onUnmounted(() => {
                if (timer) clearInterval(timer);
            });

            // --- 计算属性 (逻辑层) ---

            // 秒针角度：每秒走 6 度 (360 / 60)
            const secondDegree = computed(() => {
                return currentTime.value.second() * 6;
            });

            // 分针角度：每分走 6 度 + 秒针带来的偏移 (让分针平滑移动，而不是一分钟跳一次)
            const minuteDegree = computed(() => {
                const minutes = currentTime.value.minute();
                const seconds = currentTime.value.second();
                return (minutes * 6) + (seconds * 0.1); 
            });

            // 时针角度：每小时走 30 度 (360 / 12) + 分针带来的偏移
            const hourDegree = computed(() => {
                const hours = currentTime.value.hour();
                const minutes = currentTime.value.minute();
                return (hours % 12 * 30) + (minutes * 0.5);
            });

            // 格式化输出 (利用 Day.js 避免手动拼字符串的 Bug)
            const formattedTime = computed(() => currentTime.value.format('HH:mm:ss'));
            const formattedDate = computed(() => currentTime.value.format('YYYY年MM月DD日 dddd'));

            return {
                hourDegree,
                minuteDegree,
                secondDegree,
                formattedTime,
                formattedDate
            };
        }
    }).mount('#app');
</script>

</body>
</html>
