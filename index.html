<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§æ™ºèƒ½é‡å­æŒ–çŸ¿æœº</title>
    <style>
        :root {
            --primary: #00ffcc;
            --bg-color: #0f172a;
            --card-bg: rgba(255, 255, 255, 0.05);
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }

        /* é¡¶éƒ¨æ—¶é—´æ  */
        .header {
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .title { font-size: 24px; font-weight: bold; background: linear-gradient(90deg, #00ffcc, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .clock { font-size: 20px; font-family: monospace; color: #94a3b8; }

        /* çŸ¿æœºåŒºåŸŸ */
        .machine-container {
            margin: 50px 0;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .machine {
            font-size: 100px;
            text-shadow: 0 0 30px rgba(0, 255, 204, 0.5);
            animation: bounce 1s infinite alternate ease-in-out;
            z-index: 10;
            position: relative;
        }

        /* æœºå™¨éœ‡åŠ¨åŠ¨ç”» */
        @keyframes bounce {
            0% { transform: translateY(0) scaleY(1); }
            100% { transform: translateY(10px) scaleY(0.95); }
        }

        /* åŠ¨æ€å†’çƒŸæ•ˆæœ */
        .smoke {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            pointer-events: none;
            filter: blur(5px);
            animation: floatUp 3s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
        }

        @keyframes floatUp {
            0% { transform: translate(0, 0) scale(1); opacity: 0.8; }
            100% { transform: translate(calc(-50px + 100px * var(--dir)), -200px) scale(3); opacity: 0; }
        }

        /* çŠ¶æ€æç¤º */
        .status {
            margin-top: 20px;
            color: var(--primary);
            font-size: 14px;
            letter-spacing: 2px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

        /* çŸ¿ç‰©ä»“åº“é¢æ¿ */
        .inventory {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            width: 90%;
            max-width: 600px;
        }

        .resource-card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.2s;
        }

        .resource-card:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.08); }
        
        .resource-icon { font-size: 30px; }
        .resource-info { text-align: right; }
        .resource-name { font-size: 14px; color: #94a3b8; margin-bottom: 5px; }
        .resource-count { font-size: 24px; font-weight: bold; font-family: monospace; }

        /* ç¦»çº¿æ”¶ç›Šå¼¹çª— */
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #1e293b;
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--primary);
            text-align: center;
            max-width: 400px;
            box-shadow: 0 0 50px rgba(0, 255, 204, 0.2);
        }

        .modal h2 { margin-bottom: 15px; color: var(--primary); }
        .modal p { color: #cbd5e1; margin-bottom: 10px; line-height: 1.6;}
        .modal button {
            margin-top: 20px; padding: 10px 20px; background: var(--primary);
            color: #0f172a; border: none; border-radius: 8px; font-weight: bold;
            cursor: pointer; transition: 0.2s;
        }
        .modal button:hover { background: white; }

    </style>
</head>
<body>

    <div class="header">
        <div class="title">âš¡ é‡å­æŒ–çŸ¿ä¸­å¿ƒ</div>
        <div class="clock" id="clock">00:00:00</div>
    </div>

    <div class="machine-container">
        <div class="machine" id="machine">ğŸ­</div>
        <div class="status">â— è‡ªåŠ¨æŒ–æ˜ä¸­ï¼Œæ•°æ®å®æ—¶äº‘å­˜æ¡£...</div>
    </div>

    <div class="inventory">
        <div class="resource-card">
            <div class="resource-icon">âš«</div>
            <div class="resource-info">
                <div class="resource-name">ç…¤ç‚­ (Coal)</div>
                <div class="resource-count" id="count-coal">0</div>
            </div>
        </div>
        <div class="resource-card">
            <div class="resource-icon">âšª</div>
            <div class="resource-info">
                <div class="resource-name">é“çŸ¿ (Iron)</div>
                <div class="resource-count" id="count-iron">0</div>
            </div>
        </div>
        <div class="resource-card">
            <div class="resource-icon">ğŸŸ¡</div>
            <div class="resource-info">
                <div class="resource-name">é»„é‡‘ (Gold)</div>
                <div class="resource-count" id="count-gold">0</div>
            </div>
        </div>
        <div class="resource-card">
            <div class="resource-icon">ğŸ’</div>
            <div class="resource-info">
                <div class="resource-name">é’»çŸ³ (Diamond)</div>
                <div class="resource-count" id="count-diamond">0</div>
            </div>
        </div>
    </div>

    <div class="modal" id="offlineModal">
        <div class="modal-content">
            <h2>æ¬¢è¿å›æ¥ï¼ŒçŸ¿å·¥ï¼</h2>
            <p id="offlineTimeMsg">ä½ ç¦»å¼€äº†ä¸€æ®µæ—¶é—´...</p>
            <p>ä½ çš„æœºå™¨åšæŒä¸æ‡ˆï¼Œä¸ºä½ æŒ–åˆ°äº†ï¼š</p>
            <div id="offlineGains" style="font-weight: bold; margin: 15px 0;"></div>
            <button onclick="document.getElementById('offlineModal').style.display='none'">æ”¶ä¸‹å¥–åŠ±</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®çŠ¶æ€
        let resources = { coal: 0, iron: 0, gold: 0, diamond: 0 };
        let lastSaveTime = Date.now();

        // æŒ–çŸ¿æ¦‚ç‡ä¸æ¯ç§’äº§å‡ºåŸºç¡€è®¾å®š
        const rates = {
            coal: 5,       // æ¯ç§’å¤§è‡´ 5 ä¸ª
            iron: 2,       // æ¯ç§’å¤§è‡´ 2 ä¸ª
            gold: 0.5,     // æ¯ä¸¤ç§’ 1 ä¸ª
            diamond: 0.05  // æ¯ 20 ç§’ 1 ä¸ª
        };

        // DOM å…ƒç´ 
        const els = {
            coal: document.getElementById('count-coal'),
            iron: document.getElementById('count-iron'),
            gold: document.getElementById('count-gold'),
            diamond: document.getElementById('count-diamond'),
            clock: document.getElementById('clock')
        };

        // --- 1. æ›´æ–°å½“å‰æ—¶é—´æ˜¾ç¤º ---
        function updateClock() {
            const now = new Date();
            els.clock.innerText = now.toLocaleTimeString('zh-CN', { hour12: false });
        }
        setInterval(updateClock, 1000);
        updateClock();

        // --- 2. åŠ¨æ€å†’çƒŸæ•ˆæœ ---
        function createSmoke() {
            const machineContainer = document.querySelector('.machine-container');
            const smoke = document.createElement('div');
            smoke.classList.add('smoke');
            
            // éšæœºå¤§å°å’Œé£˜åŠ¨æ–¹å‘
            const size = Math.random() * 20 + 20; 
            const dir = Math.random(); 
            
            smoke.style.width = `${size}px`;
            smoke.style.height = `${size}px`;
            smoke.style.top = '30px';
            smoke.style.setProperty('--dir', dir); // ä¼ ç»™ CSS åŠ¨ç”»
            
            machineContainer.appendChild(smoke);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => { smoke.remove(); }, 3000);
        }
        setInterval(createSmoke, 400); // æ¯ 0.4 ç§’å†’ä¸€ä¸ªçƒŸåœˆ

        // --- 3. æ›´æ–°ç•Œé¢æ•°å­— ---
        function updateUI() {
            els.coal.innerText = Math.floor(resources.coal).toLocaleString();
            els.iron.innerText = Math.floor(resources.iron).toLocaleString();
            els.gold.innerText = Math.floor(resources.gold).toLocaleString();
            els.diamond.innerText = Math.floor(resources.diamond).toLocaleString();
        }

        // --- 4. æ ¸å¿ƒæŒ–çŸ¿é€»è¾‘ (å«ç¦»çº¿/åˆ‡åå°è®¡ç®—) ---
        function calculateGains(seconds) {
            let gained = { coal: 0, iron: 0, gold: 0, diamond: 0 };
            // å¼•å…¥ä¸€ç‚¹éšæœºæ€§ï¼ŒåŸºäºæµé€çš„ç§’æ•°
            gained.coal = seconds * rates.coal * (0.8 + Math.random() * 0.4);
            gained.iron = seconds * rates.iron * (0.8 + Math.random() * 0.4);
            gained.gold = seconds * rates.gold * (0.8 + Math.random() * 0.4);
            gained.diamond = seconds * rates.diamond * (0.8 + Math.random() * 0.4);
            return gained;
        }

        function mineTick() {
            let now = Date.now();
            let secondsPassed = (now - lastSaveTime) / 1000;
            
            // ä¸ºäº†é˜²æ­¢æ—¶é—´è·³è·ƒï¼ˆä¿®æ”¹ç³»ç»Ÿæ—¶é—´å¯¼è‡´çš„å·¨å¤§bugï¼‰ï¼Œåšä¸ªé™åˆ¶ï¼Œå•æ¬¡ tick æœ€å¤šç®— 1 å¤©
            if(secondsPassed > 86400) secondsPassed = 86400; 
            
            if (secondsPassed >= 1) { // æ¯è¿‡ 1 ç§’åŠä»¥ä¸Šè®¡ç®—ä¸€æ¬¡
                let gains = calculateGains(secondsPassed);
                resources.coal += gains.coal;
                resources.iron += gains.iron;
                resources.gold += gains.gold;
                resources.diamond += gains.diamond;
                
                lastSaveTime = now;
                updateUI();
                saveGame(); // å®æ—¶ä¿å­˜
            }
        }
        // ä½¿ç”¨ setInterval æ¨¡æ‹Ÿæœºå™¨è¿è½¬ï¼Œå³ä½¿ç”¨æˆ·åˆ‡åˆ°å…¶ä»–æ ‡ç­¾é¡µï¼Œæµè§ˆå™¨é™åˆ¶äº†æ‰§è¡Œé¢‘ç‡
        // ä¸‹æ¬¡æ‰§è¡Œæ—¶ secondsPassed ä¾ç„¶ä¼šæ ¹æ®æ—¶é—´æˆ³è¡¥é½æ”¶ç›Šï¼Œå®Œç¾å®ç°â€œåˆ‡å‡ºç½‘é¡µè¿˜åœ¨æŒ–â€ï¼
        setInterval(mineTick, 1000); 

        // --- 5. å­˜æ¡£ä¸è¯»æ¡£ ---
        function saveGame() {
            const saveData = {
                resources: resources,
                lastSaveTime: lastSaveTime
            };
            localStorage.setItem('MinerGameSave_v1', JSON.stringify(saveData));
        }

        function loadGame() {
            const savedString = localStorage.getItem('MinerGameSave_v1');
            if (savedString) {
                const saveData = JSON.parse(savedString);
                resources = saveData.resources || resources;
                
                const now = Date.now();
                const offlineSeconds = (now - saveData.lastSaveTime) / 1000;
                
                // å¦‚æœç¦»çº¿æ—¶é—´è¶…è¿‡ 60 ç§’ï¼Œå¼¹å‡ºç¦»çº¿æ”¶ç›ŠæŠ¥å‘Š
                if (offlineSeconds > 60) {
                    // é™åˆ¶æœ€å¤§ç¦»çº¿æ”¶ç›Šä¸º 7 å¤©
                    const effectiveSeconds = Math.min(offlineSeconds, 86400 * 7); 
                    const gains = calculateGains(effectiveSeconds);
                    
                    resources.coal += gains.coal;
                    resources.iron += gains.iron;
                    resources.gold += gains.gold;
                    resources.diamond += gains.diamond;

                    showOfflineModal(effectiveSeconds, gains);
                }
                
                lastSaveTime = now;
            }
            updateUI();
        }

        function showOfflineModal(seconds, gains) {
            let timeStr = "";
            if (seconds < 3600) timeStr = `${Math.floor(seconds/60)} åˆ†é’Ÿ`;
            else timeStr = `${(seconds/3600).toFixed(1)} å°æ—¶`;

            document.getElementById('offlineTimeMsg').innerText = `ä½ ç¦»å¼€äº† ${timeStr}...`;
            document.getElementById('offlineGains').innerHTML = `
                âš« ç…¤ç‚­: +${Math.floor(gains.coal).toLocaleString()} <br>
                âšª é“çŸ¿: +${Math.floor(gains.iron).toLocaleString()} <br>
                ğŸŸ¡ é»„é‡‘: +${Math.floor(gains.gold).toLocaleString()} <br>
                ğŸ’ é’»çŸ³: +${Math.floor(gains.diamond).toLocaleString()}
            `;
            document.getElementById('offlineModal').style.display = 'flex';
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        loadGame();

    </script>
</body>
</html>
