<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>系统动力引擎</title>
    <style>
        :root { --primary: #007AFF; --danger: #FF3B30; --success: #4CD964; }
        body { margin: 0; background: #000; color: #fff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: space-between; overflow: hidden; }
        
        /* 核心进度环 */
        .monitor { margin-top: 60px; position: relative; width: 240px; height: 240px; display: flex; align-items: center; justify-content: center; }
        .circle-bg { fill: none; stroke: #222; stroke-width: 12; }
        .circle-progress { fill: none; stroke: var(--primary); stroke-width: 12; stroke-linecap: round; transition: stroke-dashoffset 0.3s, stroke 0.5s; transform: rotate(-90deg); transform-origin: 50% 50%; }
        .percentage { position: absolute; font-size: 48px; font-weight: 200; }
        .status-tip { position: absolute; bottom: 40px; font-size: 14px; opacity: 0.6; }

        /* 动态波浪效果 */
        .wave-container { width: 100%; height: 100px; position: relative; overflow: hidden; }

        /* 底部控制面板 */
        .panel { width: 100%; padding-bottom: 50px; text-align: center; background: linear-gradient(to top, rgba(0,122,255,0.1), transparent); }
        .btn { background: var(--primary); color: white; border: none; padding: 18px 80px; border-radius: 40px; font-size: 18px; font-weight: 500; box-shadow: 0 10px 30px rgba(0,122,255,0.3); active { transform: scale(0.96); opacity: 0.9; } }
        .info { margin-top: 20px; font-size: 12px; color: #666; }

        /* 极度卡顿时的视觉模拟 */
        .glitch { animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } 100% { transform: translate(1px, -1px); } }
    </style>
</head>
<body>

    <div class="monitor">
        <svg width="240" height="240">
            <circle class="circle-bg" cx="120" cy="120" r="100"></circle>
            <circle id="prog" class="circle-progress" cx="120" cy="120" r="100" stroke-dasharray="628" stroke-dashoffset="628"></circle>
        </svg>
        <div class="percentage"><span id="num">0</span>%</div>
        <div class="status-tip" id="state-text">内存健康</div>
    </div>

    <div id="visual-lag" style="width: 50px; height: 50px; background: var(--primary); border-radius: 10px;"></div>

    <div class="panel">
        <button class="btn" id="main-btn">一键极致加速</button>
        <div class="info">智能分析系统冗余缓存...</div>
    </div>

    <script>
        const prog = document.getElementById('prog');
        const num = document.getElementById('num');
        const stateText = document.getElementById('state-text');
        const btn = document.getElementById('main-btn');
        const box = document.getElementById('visual-lag');

        let memoryCache = [];
        let percent = 0;
        let isCleaning = false;
        const totalSteps = 628;

        // 核心渲染循环：用来观察掉帧
        let angle = 0;
        function animate() {
            angle += 0.1;
            box.style.transform = `rotate(${angle}rad) translateX(${Math.sin(angle)*20}px)`;
            requestAnimationFrame(animate);
        }
        animate();

        // 模拟内存压入
        function simulateLoad() {
            if(isCleaning) return;

            if (percent < 98) {
                percent += Math.random() * 1.5;
                updateUI(percent);

                // 注入 TypedArray 占用真实物理内存
                // 每次增加约 16MB 的缓冲区
                try {
                    const buffer = new Uint32Array(4 * 1024 * 1024); 
                    for(let i=0; i<buffer.length; i++) buffer[i] = i; 
                    memoryCache.push(buffer);
                } catch(e) {
                    console.log("达到浏览器上限");
                }

                // 随着数值增加，动态调整视觉卡顿感
                setTimeout(simulateLoad, Math.max(50, 200 - percent * 2));
            } else {
                stateText.innerText = "内存溢出危险！";
                stateText.style.color = "var(--danger)";
                document.body.classList.add('glitch');
            }
        }

        function updateUI(p) {
            const currentP = Math.min(Math.floor(p), 100);
            num.innerText = currentP;
            const offset = totalSteps - (currentP / 100) * totalSteps;
            prog.style.strokeDashoffset = offset;

            if(p > 80) prog.style.stroke = "var(--danger)";
            else if(p > 50) prog.style.stroke = "orange";
        }

        // 清理逻辑
        btn.onclick = () => {
            isCleaning = true;
            btn.innerText = "清理中...";
            btn.style.background = "#333";
            
            // 关键：清空数组释放引用
            memoryCache = [];
            
            // 模拟清理过程
            let clearInt = setInterval(() => {
                percent -= 5;
                if (percent <= 0) {
                    percent = 0;
                    clearInterval(clearInt);
                    finishCleaning();
                }
                updateUI(percent);
            }, 30);
        };

        function finishCleaning() {
            document.body.classList.remove('glitch');
            prog.style.stroke = "var(--success)";
            stateText.innerText = "清理完成，运行如飞";
            btn.innerText = "已是最佳状态";
            btn.style.background = "var(--success)";
            
            setTimeout(() => {
                isCleaning = false;
                btn.innerText = "一键极致加速";
                btn.style.background = "var(--primary)";
                stateText.innerText = "内存健康";
                prog.style.stroke = "var(--primary)";
                simulateLoad(); // 重新开始压力测试循环
            }, 2000);
        }

        // 启动测试
        setTimeout(simulateLoad, 1000);
    </script>
</body>
</html>
